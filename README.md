# Banking Application - Microservices Demo

A banking application built with a microservices architecture demonstrating modern development practices including containerization, orchestration, and observability.

## ðŸš€ TLDR - Quick Start

### Deploy Everything (Kubernetes)
```bash
# Deploy the entire application stack
kubectl apply -k kubernetes/base/

# Deploy observability stack
kubectl apply -k kubernetes/observability/

# Access the application
kubectl port-forward -n banking-app svc/frontend 3000:3000
# Open http://localhost:3000

# Access observability tools
kubectl port-forward -n banking-app svc/grafana 3001:3000      # Grafana (admin/admin)
kubectl port-forward -n banking-app svc/prometheus 9090:9090   # Prometheus
kubectl port-forward -n banking-app svc/jaeger 16686:16686     # Jaeger
```

### Run Locally (Docker Compose)
```bash
# Start all services
docker-compose up -d

# Access the application
# Frontend: http://localhost:3000
# Grafana: http://localhost:3001 (admin/admin)
# Prometheus: http://localhost:9090
# Jaeger: http://localhost:16686
```



---

## Project Overview

A comprehensive banking application demonstrating microservices architecture with modern development practices including containerization, orchestration, and observability.

## Repository Structure

```
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ user-service/        # User authentication and profile management
â”‚   â”œâ”€â”€ accounts-service/    # Bank account and balance management
â”‚   â”œâ”€â”€ transactions-service/ # Financial transaction processing
â”‚   â””â”€â”€ api-gateway/        # Request routing and authentication
â”œâ”€â”€ frontend/               # Next.js web application
â”œâ”€â”€ kubernetes/             # Kubernetes manifests and configs
â”œâ”€â”€ config/                 # Application and monitoring configs
â””â”€â”€ scripts/                # Deployment and utility scripts
```

## Local Development

### Backend Services
```bash
# Build individual service (from service directory)
./mvnw clean package

# Run individual service locally
./mvnw spring-boot:run
```

### Frontend Development
```bash
# Start Next.js development server
cd frontend && npm run dev

# Build for production
npm run build

# Run tests
npm test
```

### Database Operations
```bash
# Connect to PostgreSQL
psql -h localhost -U postgres -d banking_app

# Run migrations (from service directory)
./mvnw flyway:migrate
```

### Testing
```bash
# Run backend unit tests
./mvnw test

# Run integration tests
./mvnw verify -P integration-tests

# Run frontend tests
cd frontend && npm test

# Run E2E tests
npm run test:e2e
```

## Architecture

### System Components
- **Frontend**: Next.js application with TypeScript
- **Backend**: Java Spring Boot microservices
- **Database**: PostgreSQL with service-specific schemas
- **Orchestration**: Kubernetes deployment
- **Observability**: OpenTelemetry with Jaeger, Prometheus, and Grafana

### Architecture Key Points
- **Authentication Flow**: JWT tokens generated by user-service, validated by all other services
- **Database Design**: Single PostgreSQL instance with separate schemas per service (user_service, accounts_service, transactions_service)
- **Service Communication**: REST APIs with JSON, all routed through API Gateway
- **Transaction Safety**: Atomic operations with rollback mechanisms in transactions-service
- **Observability**: OpenTelemetry instrumentation across all Java services

## Kubernetes Deployment

### Local Development
```bash
# Deploy with localhost configuration
kubectl apply -k kubernetes/base/
```

### Production Deployment
```bash
# Deploy with production configuration
kubectl apply -k kubernetes/overlays/speedscale/
```

**Note**: For production, edit `kubernetes/overlays/speedscale/frontend-config-patch.yaml` to set your actual API domain instead of `https://your-api-domain.com`.

### Observability Deployment

**Deploy Observability Stack**:
```bash
# Deploy all observability components (Grafana, Prometheus, Jaeger)
kubectl apply -k kubernetes/observability/
```

**Note**: The observability stack is configured to collect metrics and traces from all banking application services. Make sure your services have OpenTelemetry instrumentation enabled.

## Implementation Status

Currently in Phase 1.1 (Repository Structure) - see `plan.md` for detailed phase breakdown and testing criteria. Each phase has specific implementation tasks and testing requirements that must be completed before proceeding to the next phase.

## Key Implementation Notes

- All services must implement JWT validation middleware except user-service (which generates tokens)
- Transaction operations require account ownership validation and sufficient balance checks
- Each service needs OpenTelemetry instrumentation for distributed tracing
- Database schemas are logically separated but physically in the same PostgreSQL instance
- API Gateway handles routing, rate limiting, and global authentication checks
- All services should include comprehensive unit and integration tests with >80% coverage

## Security Considerations

- JWT tokens stored in HttpOnly cookies on frontend
- Database connections use connection pooling with proper credentials
- All services run as non-root users in containers
- API endpoints require authentication except for user registration/login
- Input validation required on all endpoints to prevent injection attacks

## Getting Started

1. **Prerequisites**: Docker, Docker Compose, Node.js, Java 11+, Maven
2. **Clone the repository**
3. **Review the implementation plan**: See `plan.md` for detailed phases
4. **Set up local environment**: Follow Phase 1 tasks in the plan
5. **Start development**: Use the development commands above

## Troubleshooting

### Common Issues

#### Frontend Issues
**Port 3000 already in use**
```bash
# Check what's using port 3000
lsof -i :3000
# Kill the process or use a different port
npm run dev -- -p 3001
```

**Build errors**
```bash
# Clear Next.js cache
rm -rf frontend/.next
npm run build
```

**API connection errors**
- Verify backend services are running
- Check API gateway configuration
- Ensure CORS settings are correct

#### Backend Issues
**Database connection failures**
```bash
# Check PostgreSQL status
docker ps | grep postgres
# Restart database
docker-compose restart postgres
```

**Service startup failures**
```bash
# Check service logs
docker-compose logs [service-name]
# Verify environment variables
docker-compose config
```

**JWT token issues**
- Check user-service is running
- Verify JWT secret configuration
- Clear browser cookies/localStorage

#### Kubernetes Issues
**Pod startup failures**
```bash
# Check pod status
kubectl get pods -n banking-app
# View pod logs
kubectl logs -n banking-app [pod-name]
# Describe pod for events
kubectl describe pod -n banking-app [pod-name]
```

**Service not accessible**
```bash
# Check service endpoints
kubectl get endpoints -n banking-app
# Verify service configuration
kubectl describe svc -n banking-app [service-name]
```

**Port forwarding issues**
```bash
# Check if port is already in use
lsof -i :3000
# Use different local port
kubectl port-forward -n banking-app svc/frontend 3001:3000
```

#### Observability Issues
**Grafana not loading dashboards**
- Check Prometheus data source configuration
- Verify metrics are being collected
- Check Grafana logs: `kubectl logs -n banking-app deployment/grafana`

**Prometheus targets down**
```bash
# Check target status
kubectl port-forward -n banking-app svc/prometheus 9090:9090
# Visit http://localhost:9090/targets
```

**Jaeger not showing traces**
- Verify OpenTelemetry configuration in services
- Check Jaeger collector logs
- Ensure services are sending traces to correct endpoint

### Debug Commands

#### Docker Compose
```bash
# View all logs
docker-compose logs -f

# View specific service logs
docker-compose logs -f [service-name]

# Check service health
docker-compose ps

# Restart specific service
docker-compose restart [service-name]
```

#### Kubernetes
```bash
# Check all resources
kubectl get all -n banking-app

# View events
kubectl get events -n banking-app --sort-by='.lastTimestamp'

# Check resource usage
kubectl top pods -n banking-app

# Debug pod with interactive shell
kubectl exec -it -n banking-app [pod-name] -- /bin/bash
```

#### Database
```bash
# Connect to database
docker exec -it [postgres-container] psql -U postgres -d banking_app

# Check database schemas
\dn

# Check table data
SELECT * FROM user_service.users LIMIT 5;
```

### Performance Issues

#### High Memory Usage
- Check JVM heap settings in application.yml
- Monitor with: `kubectl top pods -n banking-app`
- Consider increasing resource limits

#### Slow Response Times
- Check database connection pool settings
- Monitor with Grafana dashboards
- Verify network latency between services

#### Database Performance
```bash
# Check slow queries
docker exec -it [postgres-container] psql -U postgres -d banking_app -c "SELECT * FROM pg_stat_activity WHERE state = 'active';"
```

### Reset Everything

#### Local Development
```bash
# Stop and remove all containers
docker-compose down -v

# Remove all images
docker-compose down --rmi all

# Clean start
docker-compose up -d
```

#### Kubernetes
```bash
# Delete all resources
kubectl delete namespace banking-app

# Redeploy everything
kubectl apply -k kubernetes/base/
kubectl apply -k kubernetes/observability/
```

### Getting Help

1. **Check logs first**: Most issues can be diagnosed from service logs
2. **Verify prerequisites**: Ensure all required software is installed and up to date
3. **Check network connectivity**: Verify services can communicate with each other
4. **Review configuration**: Ensure all environment variables and configs are correct
5. **Search issues**: Check if the problem has been reported before

